#set -g default-terminal "tmux-256color"
set-option -g default-command $SHELL
set -g default-terminal "xterm"
#set -g default-terminal "screen-256color-bce"
#set -g default-terminal "screen-256color"
#set-option -ga terminal-overrides ",xterm-256color:Tc"
#set -ga terminal-overrides ',*:enacs@:smacs@:rmacs@:acsc@'

# remap prefix
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# make sure HOME/END works in nvim
bind-key -n Home send Escape "OH"
bind-key -n End send Escape "OF"

# navigation key bindings w/o prefix
# not needed once we have vim-tmux-navigator~!
#bind-key -n C-h select-pane -L
#bind-key -n C-j select-pane -D
#bind-key -n C-k select-pane -U
#bind-key -n C-l select-pane -R
#bind-key -n C-Left select-pane -L
#bind-key -n C-Down select-pane -D
#bind-key -n C-Up select-pane -U
#bind-key -n C-Right select-pane -R

# set mouse on
set -g mouse on

# panes
set -g pane-border-style 'fg=colour255 bg=colour0'
set -g pane-active-border-style 'bg=colour0 fg=colour9'

# customize status bar
#set -g status-right "#{prefix_highlight} | %a %H:%M %d-%b-%Y"     # set prefix indicator in right notification
# default status bar is  "\"#{=21:pane_title}\" %H:%M %d-%b-%Y"
#set -g status-left "[#{=17:session_name}] "
#set -g status-left-length 20
# copied and modified from wlc
set-window-option -g window-status-separator ''
set -g status-interval 5
set -g status-justify left
set -g status-left-length 80
set -g status-right-length 160
set -g status-left '#[bg=colour2][#S]'
#set -g status-right '#[bg=colour2] %Y/%m/%d %H:%M:%S '
#set -g status-right " #{pane_current_path} #[bg=colour2] %H:%M:%S "
#set -g status-right "#h #[bg=colour2][%H:%M]"
# settings without powerline
#set -g status-right "#{prefix_highlight}#[bg=colour234] #h [%a %H:%M %d-%b-%Y]"
setw -g window-status-current-style 'fg=colour9 bg=colour237 bold'
setw -g window-status-current-format ' #I#[fg=colour249]:#[fg=colour255]#W#F '
set -g status-style 'bg=blue fg=white bold'
# powerline settings
## reset powerline variables to force format update upon re-sourcing
set -ug @themepack-status-right-area-left-format
set -ug @themepack-status-right-area-middle-format
set -ug @themepack-status-right-area-left-suffix
set -ug @theme-status-right
## now we can set the powerline status bar
set -g @theme-status-left-length 80
#set -g @themepack-status-right-area-left-format '%H:%M:%S'
set -g @themepack-status-right-area-left-format '#(TZ="Asia/Taipei" date +" TW %%H:%%M:%%S")'
set -g @themepack-status-right-area-left-suffix '#(TZ="America/Los_Angeles" date +" (PT %%H:%%M)")'
set -g @themepack-status-right-area-middle-format '%a %b-%d'
#set -g @themepack-status-right-area-left-suffix '#(TZ="Asia/Taipei" date +" (TW %%H:%%M)")'
set -g @theme-status-right-prefix "#{prefix_highlight} "

#set -g @theme-status-right '| #{sysstat_cpu} | #{sysstat_mem} | #{sysstat_swap} | #[fg=#{@powerline-status-right-area-left-bg},bg=#{@theme-status-bg}]#[fg=#{@powerline-status-right-area-left-fg},bg=#{@powerline-status-right-area-left-bg}] %H:%M:%S #[fg=#{@powerline-status-right-area-middle-bg},bg=#{@powerline-status-right-area-left-bg}]#[fg=#{@powerline-status-right-area-middle-fg},bg=#{@powerline-status-right-area-middle-bg}] %d-%b-%y #[fg=#{@powerline-status-right-area-right-bg},bg=#{@powerline-status-right-area-middle-bg}]#[fg=#{@powerline-status-right-area-right-fg},bg=#{@powerline-status-right-area-right-bg},bold] #H '


set -g base-index 1
set -g pane-base-index 1


# resurrect or continuum
set -g @resurrect-strategy-vim 'session'                          # restore vim when resurrecting tmux
set -g @continuum-restore 'off' #'on'                             # automatically restore upon tmux startup

# copy and yank behaviors
set -g mode-keys vi                                                                                   # copy mode vi
set -g @yank_selection        'clipboard' # 'clipboard' # or 'secondary' or 'clipboard'                             # yank to system clipboard
set -g @yank_selection_mouse  'clipboard' # 'clipboard' # or 'primary' or 'secondary'                               # yank to system clipboard
set -g @yank_with_mouse       off # or 'on'                                                           # turn off mouse yank, use following setting to override mouse release behavior
bind-key -T copy-mode-vi  MouseDragEnd1Pane  send-keys -X # copy-pipe-no-clear                        # do not clear selection upon mouse release; wait for yank or Enter
bind-key -T copy-mode-vi  y                  send-keys -X copy-pipe-and-cancel "xsel -i --clipboard"  # override y behavior: yank to clipboard
bind-key -T copy-mode-vi  Enter              send-keys -X copy-pipe-and-cancel "xsel -i --clipboard"  # override Enter behavior: yank to clipboard
# now in copy-mode (both when triggered by mouse click or by <prefix>+[),
# both 'y' and Enter will yank selected text to clipboard
# copied text will be available by pasting with primary copy cache (<prefix>+]) or with system clipboard
bind-key v paste-buffer
set-hook -g after-set-buffer "run-shell 'tmux show-buffer | xsel -i --clipboard >/dev/null 2>&1 &'"
bind-key W swap-pane

set-option -g @pane_resize "10"

# vim tmux navigator settings
set -g @vim_navigator_mapping_left "C-Left C-h"
set -g @vim_navigator_mapping_right "C-Right C-l"
set -g @vim_navigator_mapping_up "C-Up C-k"
set -g @vim_navigator_mapping_down "C-Down C-j"
set -g @vim_navigator_mapping_prev "" # removes the C-\ binding to previous pane
set -g @vim_navigator_prefix_mapping_clear_screen "" # disable automatic mapping of <prefix> C-l to send C-l (for clear screen functionality in tmux)


# plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'jimeh/tmux-themepack'
set -g @themepack 'powerline/block/gray'
#set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'

# initialize TMUX plugin manager
run '~/.tmux/plugins/tpm/tpm'

# overrides tmux-pain-control
bind-key "|" split-window -fh -c "#{pane_current_path}"
bind-key "\\" split-window -h -c "#{pane_current_path}"


## nvim REPL hooks and bindings
# Hooks for handling cluster tmux
#SCRIPT_DIR="$HOME/.config/tmux"
#set-hook -g session-created  "run-shell \"$SCRIPT_DIR/_tmux_custom.sh session_start   '#{hook_session_name}' '#{hook_session}'\""
#set-hook -g session-closed   "run-shell \"$SCRIPT_DIR/_tmux_custom.sh session_close   '#{hook_session_name}'\""
#set-hook -g session-renamed  "run-shell \"$SCRIPT_DIR/_tmux_custom.sh session_rename  '#{hook_session_name}' '#{hook_session}'\""
# Spawning "standard windows"
#bind-key e   run-shell "$SCRIPT_DIR/_tmux_custom.sh editor_window   #{session_name}"
#bind-key g   run-shell "$SCRIPT_DIR/_tmux_custom.sh _guard_repl_bkg #{session_name}"
## end of nvim REPL settings

